<!DOCTYPE html>
<html lang="en">
<head>

<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1"/>
<meta name="natural history" content="netrc"/>
<title> natural history </title>

<link  href="http://fonts.googleapis.com/css?family=Syncopate:regular,bold" rel="stylesheet" type="text/css" />

<style type="text/css">
body {
	background-color: #A0A0A0;
}

.nhKingdom {
  font-weight: bold;
}
.nhGenus {
  font-weight: bold;
  font-style: italic;
}
.nhNote {
  font-style: italic;
}

</style>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="jquery-ui.custom.js"></script>


<link href="skin-win8/ui.fancytree.css" rel="stylesheet" type="text/css">
<script src="jquery.fancytree.js" type="text/javascript"></script>

<script src="testNH.js"></script>

<script type="text/javascript">
  // https://github.com/mar10/fancytree
  // http://wwwendt.de/tech/fancytree/demo/
  // https://github.com/mar10/fancytree/wiki
  // http://wwwendt.de/tech/fancytree/doc/jsdoc/global.html#FancytreeOptions
  function convertToFT( n, l ) {
    var thisObject = { title: NH[l] + " <span class=\"nh"+NH[l]+"\">" };
      if (n.hasOwnProperty("link")) {
        thisObject.title += "<a href=\"" + n.link + "\">";
      }
      thisObject.title += n.val ;
      if (n.hasOwnProperty("link")) {
        thisObject.title += "</a>";
      }
      thisObject.title += "</span>";
    if (n.hasOwnProperty("note")) {
      thisObject.title += " - <span class=\"nhNote\">" + n.note + "</span>"
    }
    //console.log("dftn: " + thisObject.title );
    if (n.hasOwnProperty("nodes")) { 
      thisObject.children = [];
      n.nodes.map( function(e) { thisObject.children.push( convertToFT(e,l+1) ) } );
    }
    return thisObject;
  }

  function addChild() {
    alert("add child enter");
    var p = $("#nh").fancytree("getActiveNode");
    if ( p ) {
      alert("parent: " + p.title);
      p.addChildren( { title: "new thing" } );
    } else {
      alert("please select a node to which to add");
    };
  }

  nhURL = "https://drive.google.com/file/d/0B3DOTAPt_Yb-cnlWVXFiOWc0SkU";
  nhURL = "https://doc-14-bg-docs.googleusercontent.com/docs/securesc/o7l0aeqi0drljltr83c3565k9441n6of/6bsm9mpnd6u1s37kn94td5qkvbs2i1ih/1405101600000/00764896983689527275/13058876669334088843/0B3DOTAPt_Yb-cnlWVXFiOWc0SkU?h=16653014193614665626&e=download&gd=true"
  function getNH() {
    var aToken = gapi.auth.getToken();
    var xhr = new XMLHttpRequest();
    xhr.open('GET', nhURL);
    xhr.setRequestHeader('Authorization','Bearer ' + aToken);
    xhr.onload = function() { alert("getnh onload... " + xhr.responseText); };
    xhr.onerror = function() { alert("getnh onerror"); };
    xhr.send();
  }

  function gapiLoaded() {
    alert("gapi ready");
    //gapi.client.load('auth');
    getNH();
  }

  $(document).ready(function() {
    //xhrFields:{withCredentials:true}
    //$.ajax( { url: nhURL, dataType:"json"} )
    //  .done( function( data ) { alert("got back data") })
    //  .fail( function( jqxhr,ts,error ) { alert("failure! "+error ) });
    nhFancyTree = convertToFT(testNodes,0);
    $("#nh").fancytree({source: nhFancyTree});
    $("#nh").fancytree("getRootNode").visit(function(node){ node.setExpanded(true); });

    $("#AddChild").on('click',addChild);

  });
  // <li data-icon="customDoc1.gif">Node with standard CSS, but custom icon

</script>
</script>
</head>

<body>

<h2> Natural History of 7 Byron Road </h2>

<div id="nh">
</div>
<hr>
<button id="AddChild"> Add Child </button>
<button id="EditChild"> Edit Node </button>
</body>
<script src="http://apis.google.com/js/client.js?onload=gapiLoaded"></script>

</html>
